---
title: 浏览器的工作原理
categories: 浏览器
tags: 浏览器工作原理
---

## 浏览器的工作原理

### 浏览器的工作流程



1. 浏览器首先使用HTTP协议或者HTTPS协议，向服务端请求页面；
2. 把请求回来的HTML代码经过解析，构建成DOM树；
3. 计算DOM树上的CSS属性；
4. 根据CSS属性对元素逐个进行渲染，得到内存中的位图；
5. 一个可选的步骤是对位图进行合成，这会极大地增加后续绘制的速度；
6. 合成只会，再绘制到界面上。

### 浏览器的标准

HTTP1.1 https://tools.ietf.org/html/rfc2616

HTTP1.1 https://tools.ietf.org/html/rfc7234

http协议是基于tcp协议的基础上出现的。





### HTTP Method

HTTP的一些请求方法：

- GET  **通过一个地址栏去访问一个页面**
- POST **表单提交**
- HEAD **由js发起和类似，只返回响应头**
- PUT ****
- DELETE
- CONNECT **大部分是用于https等**
- OPTIONS **只用于调试**
- TRACE **一般是用于调试**



### HTTP Status code

响应的编码：

- 1xx： 临时回应，表示客户端请继续（直接被http库处理掉）
- 2xx：请求成功
- 3xx：表示请求的目标有变化，希望客户的进一步处理。
- 4xx：客户端请求错误
- 5xx：服务端请求错误

### HTTP Head

| Request Header    | 规定                                                         |
| ----------------- | ------------------------------------------------------------ |
| Accept            | 浏览器端接受的格式                                           |
| Accept-Encoding： | 浏览器端接受的编码方式                                       |
| Accept-Language   | 浏览器端接受的语言，用于服务端判断多语言                     |
| Cache-Control     | 控制缓存的时效性                                             |
| Connection        | 连接方式，如果是keep-alive，且服务端支持，则会复用连接       |
| Host              | Http访问使用的域名。                                         |
| if-Modified-Since | 上次访问时的更改时间，如果服务端认为此时间后自己没有更新，则会给出304响应。 |
| if-None-Match     | 次访问时使用的E-tag，通常是页面的信息摘要，这个比更改时间更准确一些 |
| User-Agent        | 客户端标识，因为一些历史原因，这是一笔糊涂账，多数浏览器的这个字段都十分复杂，区别十分微妙。 |
| Cookie            | 客户端存储的cookie字符串。                                   |

### Response Header

| Response Header  | 规定                                                         |
| ---------------- | ------------------------------------------------------------ |
| Cache-Control    | 缓存控制，用于通知各级缓存保存的时间，例如max-age=0，表示不要缓存。 |
| Connection       | 连接类型，Keep-Alive表示复用连接                             |
| Content-Encoding | 内容编码方式，通常是gzip。                                   |
| Content-Length   | 内容长度，有利于浏览器判断内容是否已经结束。                 |
| Content-Type     | 内容类型，所有请求网页的都是text/html。                      |
| Date             | 当前的服务器日期。                                           |
| Etag             | 页面的信息摘要，用于判断是否需要重新到服务端取回页面。       |
| Expires          | 过期时间，用于判断下次请求是否需要到服务端取回页面           |
| Keep-Alive       | 保持连接不断时需要的一些信息，如timeout=5，max=100,          |
| Last-Modified    | 页面上次修改的时间                                           |
| Server           | 服务端软件的类型                                             |
| Set-Cookie       | 设置cookie，可以存在多个。                                   |
| Via              | 服务端的请求链接，对一些调试场景至关重要的一个头。           |

### HTTP Request Body

- application/json
- application/x-www-form-urlencoded
- multipart/form-data
- text/xml

### 从输入URL到页面展示，这个中间发生了什么

1. 用户输入（浏览器进程）
2. 处理输入信息（浏览器进程）
3. 开始导航（浏览器进程）
4. 发起URl请求（网络进程）
5. 重定向（浏览器进程）
6. 发起URL请求（网络进程）
7. 读取响应头信息（网络进程）
8. 准备渲染过程（浏览器进程）
9. 提交文档（渲染过程）（当浏览器进程接受到网络进程的响应头数据之后，便向渲染进程发起 “提交文档”的消息，渲染进程接受到“提交文档”的消息之后，会和网络进程建立传输数据的“管道”，就是IPC。等文档数据传输完成之后，渲染进程会返回“确认提交”的消息给浏览器进程。浏览器进程在收到“确认提交“消息之后，会更新浏览器界面状态，包括了安全状态、地址栏的URL、前进后退的历史状态，并更新Web界面）。
10. 确认文档被提交（浏览器进程）
11. 读取响应体数据（网络进程）
12. 页面解析和子资源加载（渲染进程）
13. 页面加载完成（浏览器进程）



三个进程：浏览器进程，网络进程，渲染进程



#### 浏览器进程的职责

主要负责用户交互，子进程管理和文件储存等功能。

#### 网络进程的职责

网络进程是面向渲染进程和浏览器等提供网络下载功能。

#### 渲染进程的职责

渲染进程的主要职责是把从网络下载的HTML、JavaScript、Css、图片等资源解析为可以显示和交互的页面。



### 渲染进程

默认情况下，Chorme会为每一个页面分配一个新的渲染进程。





























